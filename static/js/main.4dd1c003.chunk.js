(this.webpackJsonpbattlegrid=this.webpackJsonpbattlegrid||[]).push([[0],{35:function(e,t,n){e.exports=n(58)},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},49:function(e,t,n){},51:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=51},52:function(e,t,n){},58:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),c=n(14),a=n.n(c),i=(n(40),n(41),n(9)),s=n(20),u=n(10);function l(e){return[e.clientX,e.clientY]}function f(e){return e.map(Math.floor)}function d(e,t){return[e[0]+t[0],e[1]+t[1]]}function p(e,t,n){return Math.min(n,Math.max(t,e))}var h=o.a.memo((function(e){return o.a.createElement("div",{style:{position:"absolute",left:"0",top:"0",width:e.width+"em",height:e.height+"em",backgroundPosition:"top left",background:"repeating-linear-gradient(to right, grey, grey ".concat("1px",", transparent ").concat("1px"," 1em), repeating-linear-gradient(to bottom, grey, grey ").concat("1px",", transparent ").concat("1px"," 1em)"),pointerEvents:"none"}})})),v=(n(42),n(22)),m=Object(r.memo)(Object(r.forwardRef)((function(e,t){var n=Object(r.useRef)(null),c=Object(r.useRef)(null),a=Object(r.useRef)({scale:1,offset:[0,0]}),s=function(t){var r=t(a.current),o=[p(r.offset[0],0,e.width),p(r.offset[1],0,e.height)];a.current={scale:r.scale,offset:o},console.log("offset",a.current.offset),c.current.style.fontSize="".concat(a.current.scale*e.baseScalar).concat(e.baseUnit),n.current.scrollTo(96*a.current.offset[0]*a.current.scale,a.current.offset[1]*a.current.scale*96)},u=Object(r.useRef)(1);Object(v.a)({onPinchEnd:function(){u.current=a.current.scale},onPinch:function(e){var t,n,r;null===(t=e.event)||void 0===t||t.preventDefault(),null===(n=e.event)||void 0===n||n.stopPropagation();var o,c=null===(r=e.event)||void 0===r?void 0:r.deltaY,i=l(e.origin);if(console.log(i),c){var f=-1*c*.05*a.current.scale;o=a.current.scale+f}else o=e.da[0]/e.initial[0]-1+u.current;!function(e,t,n){var r=p(n-t,-.05,.05);(n=p(t+r,.2,2))!==t&&s((function(o){return console.log(a.current.scale),{scale:n,offset:[o.offset[0]-(o.offset[0]-e[0])*r/t,o.offset[1]-(o.offset[1]-e[1])*r/t]}}))}(i,a.current.scale,o)},onPinchStart:Object(r.useCallback)((function(e){console.log("pinchstarting"),u.current=a.current.scale}),[a])},{domTarget:n,eventOptions:{passive:!1,capture:!0}});var l=function(e){var t=c.current.getBoundingClientRect();return[(e[0]-t.left)/96/a.current.scale,(e[1]-t.top)/96/a.current.scale]};Object(r.useImperativeHandle)(t,(function(){return{clientToGrid:l}}),[]);var f=Object(v.a)({onScrollEnd:function(e){console.log("OOPS",e.pinching),s((function(e){return Object(i.a)(Object(i.a)({},e),{},{offset:[n.current.scrollLeft/96/a.current.scale,n.current.scrollTop/96/a.current.scale]})}))}});return o.a.createElement("div",Object.assign({className:"viewport"},f(),{ref:n}),o.a.createElement("div",{className:"gridsvg",ref:c,style:{width:"".concat(e.width,"em"),height:"".concat(e.height,"em"),fontSize:"".concat(a.current.scale*e.baseScalar).concat(e.baseUnit),position:"relative"}},e.children))})));var g=Object(r.memo)((function(e){return o.a.createElement("div",Object.assign({},e,{style:Object(i.a)({position:"absolute",left:e.loc[0]+"em",top:e.loc[1]+"em",width:.05+e.dim[0]+"em",height:.05+e.dim[1]+"em"},e.style)}),e.children)}));var b=function(e){var t=Object(r.useRef)(null),n=Object(r.useCallback)((function(n){t.current&&(n.preventDefault(),n.stopPropagation(),console.log(n.clientX,n.clientY),e.onSelectionDrag(l(n)))}),[e]),c=Object(r.useCallback)((function(n){null!==t.current&&(n.preventDefault(),n.stopPropagation(),console.log("Drop!"),e.onSelectionDrop(l(n)),t.current=null)}),[e]);return o.a.createElement(g,{loc:e.loc,dim:e.dim,style:{border:"0.05em solid ActiveBorder",boxShadow:"0 0 5px activeborder"},onPointerDown:function(e){e.preventDefault(),e.stopPropagation(),console.log("CLICKED SELECTION ?D?D!"),e.currentTarget.setPointerCapture(e.pointerId),t.current=l(e)},onPointerMoveCapture:n,onPointerUpCapture:c})};var O=Object(r.memo)((function(e){var t,n=Object(r.useRef)(null),c=Object(r.useRef)(null),a=Object(r.useState)(null),l=Object(u.a)(a,2),p=l[0],v=l[1],O=Object(r.useRef)(null),j=Object(r.useRef)(null),y=Object(r.useState)([]),w=Object(u.a)(y,2),E=w[0],D=w[1],k=function(e,t,n){var o=Object(r.useState)(0),c=Object(u.a)(o,2),a=c[0],i=c[1],s=Object(r.useState)({x:0,y:0}),l=Object(u.a)(s,2),f=l[0],d=l[1];return console.log(a),[a>0,f,{onDragEnter:function(e){e.preventDefault(),e.stopPropagation();var t=[e.clientX,e.clientY],n=t[0],r=t[1];i((function(e){return e+1})),d({x:n,y:r})},onDragLeave:function(e){e.preventDefault(),e.stopPropagation();var t=[e.clientX,e.clientY],n=t[0],r=t[1];i((function(e){return e-1})),d({x:n,y:r})},onDragOver:function(e){e.preventDefault(),t(e.clientX,e.clientY)},onDrop:function(e){e.preventDefault(),console.log("DROPPED!");var t=[e.clientX,e.clientY],r=t[0],o=t[1];i(0),d({x:r,y:o}),n(e)}}]}(0,(function(e,t){if(j.current){var n=O.current.clientToGrid([e,t]);j.current.style.left=Math.floor(n[0])+"em",j.current.style.top=Math.floor(n[1])+"em"}}),(function(e){var t,n,r=O.current.clientToGrid([e.clientX,e.clientY]);console.log("DROP!");var o=null!==(t=null===(n=e.dataTransfer)||void 0===n?void 0:n.items)&&void 0!==t?t:[],c=function(e,t){console.log("adding item?");var n={id:""+Math.random(),x:Math.floor(r[0])+t,y:Math.floor(r[1]),width:1,height:1,href:e};console.log("DROPPING? ",n),D([].concat(Object(s.a)(E),[n]))};console.log("event",e),console.log("items",o);for(var a=0;a<o.length;a++)console.log(o[a]),o[a].kind.startsWith("image/")?c(window.URL.createObjectURL(o[a].getAsFile()),0):"text/uri-list"===o[a].type&&o[a].getAsString((function(e){return c(e,0)}))})),x=Object(u.a)(k,3),P=x[0],S=x[1],C=x[2];return P&&(t=O.current.clientToGrid([S.x,S.y])),console.log(E),o.a.createElement("div",Object.assign({className:"grid"},C,{ref:n}),o.a.createElement(m,{ref:O,baseScalar:1,baseUnit:"in",width:e.dimensions[0],height:e.dimensions[1]},P?o.a.createElement("div",{ref:j,key:"hover",style:{position:"absolute",left:Math.floor(t[0])+"em",top:Math.floor(t[1])+"em",width:"1em",height:"1em",background:"#aaa"}}):null,E.map((function(e){var t;return o.a.createElement(g,{key:e.id,loc:d([e.x,e.y],(null===(t=c.current)||void 0===t?void 0:t.id)===e.id?p:[0,0]),dim:[1,1],onClick:function(){c.current=e,v([0,0])}},o.a.createElement("img",{alt:"",src:e.href,style:{display:"block",width:"100%",height:"100%"}}))})),o.a.createElement(h,{width:e.dimensions[0],height:e.dimensions[1]}),c.current&&o.a.createElement(b,{key:"",loc:d(p,[c.current.x,c.current.y]),dim:[1,1],onSelectionDrag:function(e){return v(f((t=O.current.clientToGrid(e),n=[c.current.x,c.current.y],[t[0]-n[0],t[1]-n[1]])));var t,n},onSelectionDrop:function(e){var t=f(O.current.clientToGrid(e)),n=c.current.id;D((function(e){return e.map((function(e){return e.id===n?Object(i.a)(Object(i.a)({},e),{},{x:t[0],y:t[1]}):e}))})),v(null),c.current=null}})))})),j=n(8);n(49);var y=function(e){return o.a.createElement("div",{className:"toolbar"},e.children)},w=n(1),E=n.n(w),D=n(7),k=n(2),x=n(15),P=n(16),S=n(17),C=n.n(S),R=function(){function e(t,n){Object(x.a)(this,e),this.server=void 0,this.server=t,this.server.on("data",(function(e){n.onMessage(e)})),this.server.on("error",(function(e){console.log("ERROR!")}))}return Object(P.a)(e,null,[{key:"connect",value:function(){var t=Object(D.a)(E.a.mark((function t(n,r){var o,c;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=new C.a(void 0,{debug:3}),c=!1,t.abrupt("return",new Promise((function(t,a){o.on("open",(function(i){var s=o.connect(n,{reliable:!0}),u=new e(s,r);s.on("open",(function(){console.log("Open sesame?"),c=!0,t(u)})),s.on("error",(function(e){!c&&a("Error connecting to game host: ".concat(e))}))})),o.on("error",(function(e){!c&&a("Error connecting to signaling server: ".concat(e))}))})));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}(),T=n(30),M=function(){function e(t,n,r){var o=this;Object(x.a)(this,e),this.peer=void 0,this.clients=void 0,this.id=void 0,this.peer=n,this.id=t,this.clients=new Map,this.peer.on("connection",(function(e){e.on("open",(function(){var t=e.label;o.clients.set(t,e),r.onConnect&&r.onConnect(t),r.onDisconnect&&e.on("close",(function(){console.log("Disconnecting?"),r.onDisconnect(t)}))}))})),this.peer.on("disconnected",(function(){console.error("ACK! Disconnect from signaler.")}))}return Object(P.a)(e,[{key:"broadcast_json",value:function(e){var t,n=Object(T.a)(this.clients.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;console.log("sending!"),r.send(e)}}catch(o){n.e(o)}finally{n.f()}}},{key:"send",value:function(e,t){this.clients.get(e).send(t)}}],[{key:"create",value:function(){var t=Object(D.a)(E.a.mark((function t(n){var r,o;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new C.a(void 0,{debug:3}),o=!1,t.abrupt("return",new Promise((function(t,c){r.on("open",(function(c){o=!0,t(new e(c,r,n))})),r.on("error",(function(e){o&&c("Failed to create server: ".concat(e))}))})));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}(),N=function(e){return new Promise((function(t){return setTimeout(t,e)}))},I=Object(k.b)("toast/issue",function(){var e=Object(D.a)(E.a.mark((function e(t,n){var r,o;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.dispatch,o=Date.now(),r(Y({id:Date.now(),msg:t})),e.next=5,N(5e3);case 5:r(G(o));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),L=Object(k.c)({name:"toast",initialState:{toasts:[]},reducers:{addToast:function(e,t){var n=t.payload;e.toasts.push(n)},removeToast:function(e,t){var n=t.payload;e.toasts=e.toasts.filter((function(e){return e.id!==n}))}}}),U=L.reducer,A=L.actions,Y=A.addToast,G=A.removeToast,X={client:null,host:null},F=Object(k.b)("posts/fetchPosts",function(){var e=Object(D.a)(E.a.mark((function e(t,n){var r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.dispatch,e.prev=1,e.next=4,R.connect(t,{onMessage:function(e){r(e)}});case 4:return X.client=e.sent,e.abrupt("return",t);case 8:throw e.prev=8,e.t0=e.catch(1),r(I("joinFailure")),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}()),_=Object(k.b)("posts/fetchPosts",function(){var e=Object(D.a)(E.a.mark((function e(t,n){var r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.dispatch,e.next=3,M.create({onConnect:function(e){r(B.actions.addPlayer(e))}});case 3:return X.host=e.sent,window.history.pushState({},"","?join=".concat(X.host.id)),e.abrupt("return",X.host.id);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),B=Object(k.c)({name:"conn",initialState:{connected:!1,hosting:!1,gameId:null,players:[]},reducers:{addPlayer:function(e,t){var n=t.payload;e.players.push(n)}},extraReducers:function(e){e.addCase(F.fulfilled,(function(e,t){var n=t.payload;e.gameId=n,e.connected=!0}))}}),z=B.reducer,H=Object(k.c)({name:"grid",initialState:{width:30,height:30},reducers:{setDimensions:function(e,t){var n=t.payload;e.width=n.width,e.height=n.height}}}),J=H.reducer,K=H.actions.setDimensions,V=(n(52),n(60)),W=n(26);function q(e){var t=Object(j.c)((function(e){return e.toast.toasts})),n=Object(V.a)().t;return o.a.createElement("div",{className:"toastArea"},o.a.createElement(W.a,null,t.map((function(e){return o.a.createElement(W.b.div,{className:"toast",initial:{position:"relative",opacity:0},animate:{position:"relative",opacity:1},exit:{position:"relative",opacity:0},layout:!0,key:e.id},n(e.msg))}))))}var Q=function(){var e=Object(j.c)((function(e){return console.log(e),e.comms})),t=Object(j.c)((function(e){return[e.grid.width,e.grid.height]})),n=Object(j.b)(),r=Object(V.a)().t;return o.a.createElement("div",{className:"App"},o.a.createElement(q,null),o.a.createElement(O,{dimensions:t}),o.a.createElement(y,null,o.a.createElement("button",{onClick:function(){return n(K({width:t[0]+1,height:t[1]}))}},"Add Column"),o.a.createElement("button",{onClick:function(){return n(K({width:t[0],height:t[1]+1}))}},"Add Row"),o.a.createElement("button",{onClick:function(){return n(I(r("hello")))}},"Say hi"),!e.connected&&o.a.createElement("button",{onClick:function(){return n(_())}},"Host"),e.hosting&&"hosting: ".concat(e.gameId),e.connected&&!e.hosting&&e.players.map((function(e){return o.a.createElement("span",{key:e},e)}))))},Z=Object(k.a)({reducer:{comms:z,grid:J,toast:U},middleware:function(e){return[].concat(Object(s.a)(e()),[function(e){return function(e){return function(t){return console.log(t),X.host&&X.host.broadcast_json(t),e(t)}}}])}}),$=n(25),ee=n(13),te=n(34);$.a.use(te.a).use(ee.e).init({debug:!0,lng:"en",fallbackLng:"en",whitelist:["en","de"],interpolation:{escapeValue:!1},backend:{loadPath:"/battlegrid/locales/{{lng}}/{{ns}}.json"}});$.a;var ne=new URLSearchParams(window.location.search).get("join");ne&&Z.dispatch(F(ne)),a.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(r.Suspense,{fallback:null},o.a.createElement(j.a,{store:Z},o.a.createElement(Q,null)))),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.4dd1c003.chunk.js.map