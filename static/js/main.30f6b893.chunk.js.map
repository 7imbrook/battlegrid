{"version":3,"sources":["../node_modules/peerjs/dist sync","components/grid2/util.ts","components/grid2/Overlay2.tsx","components/grid2/Viewport.tsx","components/grid2/GridItem.tsx","components/grid2/SelectionBox.tsx","components/grid2/Grid.tsx","components/util/useDrop.ts","components/toolbar/Toolbar.tsx","modules/comms/client.ts","modules/comms/server.ts","modules/toast.ts","modules/comms/index.ts","modules/grid/index.ts","components/toasts/ToastArea.tsx","components/App.tsx","store.ts","i18n.ts","index.tsx"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","coord","ev","clientX","clientY","floor","a","map","Math","add","b","clamp","val","min","max","React","memo","props","style","position","left","top","width","height","backgroundPosition","background","pointerEvents","Viewport","forwardRef","ref","viewport","useRef","canvas","transform","scale","offset","setTransform","f","newT","current","newOffset","console","log","fontSize","baseScalar","baseUnit","scrollTo","initialScale","pinch","useGesture","onPinchEnd","onPinch","state","event","preventDefault","stopPropagation","deltaY","client_origin","origin","newScale","clientToGrid","delta","da","initial","oldScale","t","performZoom","onPinchStart","useCallback","domTarget","eventOptions","passive","capture","useEffect","rect","getBoundingClientRect","useImperativeHandle","scroll","onScrollEnd","pinching","scrollLeft","scrollTop","className","children","GridItem","loc","dim","SelectionBox","initialLoc","onPointerMove","onSelectionDrag","onPointerUp","onSelectionDrop","border","boxShadow","onPointerDown","currentTarget","setPointerCapture","pointerId","onPointerMoveCapture","onPointerUpCapture","gridDrag","dropLayer","selection","useState","selectionOffset","setSelectionOffset","hoverHint","items","setItems","onDrag","onDrop","dragDepth","setDragDepth","x","y","dragState","setDragState","onDragEnter","d","onDragLeave","onDragOver","useDrop","coords","dataItems","dataTransfer","addItem","s","i","item","random","href","length","kind","startsWith","window","URL","createObjectURL","getAsFile","type","getAsString","dragging","drag","dragHandlers","dimensions","key","onClick","alt","src","display","currId","it","Toolbar","Client","server","config","this","on","onMessage","serverId","peer","Peer","undefined","debug","connected","Promise","reject","connect","reliable","client","Server","clients","Map","conn","label","set","onConnect","onDisconnect","error","msg","values","c","send","get","sleep","m","r","setTimeout","issueToast","createAsyncThunk","dispatch","Date","now","addToast","removeToast","toast","createSlice","name","initialState","toasts","reducers","payload","push","filter","actions","host","gameId","start_hosting","_","create","slice","addPlayer","history","pushState","hosting","players","extraReducers","builder","addCase","fulfilled","setDimensions","ToastArea","useSelector","useTranslation","div","opacity","animate","exit","layout","App","comms","grid","useDispatch","p","store","configureStore","reducer","middleware","api","next","action","broadcast_json","i18n","use","Backend","initReactI18next","init","lng","fallbackLng","whitelist","interpolation","escapeValue","backend","loadPath","game","URLSearchParams","location","search","ReactDOM","render","StrictMode","fallback","document","getElementById"],"mappings":"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","file":"static/js/main.30f6b893.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 51;","import { ClientSpace } from \"./Viewport\";\n\ninterface Unit<T> {\n    _unitBrand: T\n}\nexport type Coord<T> = [number, number] & Unit<'coord'>\nexport type Offset<T> = [number, number] & Unit<'offset'>\nexport type Pair<T> = Coord<T> | Offset<T>\n\nexport function coord(ev: {clientX: number, clientY: number}): Coord<ClientSpace> {\n    return [ev.clientX, ev.clientY] as Coord<ClientSpace> \n}\n\nexport function floor<T extends [number, number] > (a: T): T {\n    return a.map(Math.floor) as T\n}\n\nexport function trunc<T extends [number, number] > (a: T): T {\n    return a.map(n => n < 0 ? Math.ceil(n) : Math.floor(n)) as T\n}\n\n\nexport function add<T>(a: Offset<T>, b: Offset<T>): Offset<T>;\nexport function add<T>(a: Coord<T>, b: Offset<T>): Coord<T>\nexport function add<T>(a: [number, number], b: [number,number]): [number,number] {\n    return [a[0] + b[0], a[1] + b[1]] as any;\n}\n\nexport function sub<T>(a: Offset<T>, b: Offset<T>): Offset<T>;\nexport function sub<T>(a: Coord<T>, b: Offset<T>): Coord<T>\nexport function sub<T>(a: Coord<T>, b: Coord<T>): Offset<T>\nexport function sub<T>(a: [number, number], b: [number,number]): [number,number] {\n    return [a[0] - b[0], a[1] - b[1]] as any;\n}\n\nexport function clamp(val: number, min: number, max: number) {\n  return Math.min(max, Math.max(min, val));\n}\n\nexport function coord_clamp<T, P extends Pair<T>>(val: P, min: [number, number], max: [number, number]): P {\n    return [\n        Math.max(min[0], Math.min(max[0], val[0])),\n        Math.max(min[1], Math.min(max[1], val[1])),\n    ] as P;\n}","import React from \"react\";\nimport { GridSpace } from \"./Viewport\";\nimport { Coord } from \"./util\";\n\nexport interface OverlayProps {\n  width: number,\n  height: number,\n  onDrop?: (coord: Coord<GridSpace>) => void;\n}\n\nconst thickness = \"1px\"\nfunction Overlay2(props: OverlayProps) {\n  return (<div style={{\n    position: \"absolute\",\n    left: \"0\",\n    top: \"0\",\n    width: props.width + 'em',\n    height: props.height + 'em',\n    backgroundPosition: \"top left\",\n    background: `repeating-linear-gradient(to right, grey, grey ${thickness}, transparent ${thickness} 1em), repeating-linear-gradient(to bottom, grey, grey ${thickness}, transparent ${thickness} 1em)`,\n    pointerEvents: \"none\",\n  }}></div>\n  );\n}\nexport default React.memo(Overlay2);","import { useRef, useCallback, PropsWithChildren, ForwardRefRenderFunction, useImperativeHandle, forwardRef, memo, useEffect } from \"react\";\nimport { Coord, clamp } from \"./util\";\nimport { useGesture } from \"react-use-gesture\";\nimport { FullGestureState } from \"react-use-gesture/dist/types\";\n\n\nimport React from \"react\";\n\nexport interface ViewportProps {\n  baseScalar: number,\n  baseUnit: string,\n  height: number,\n  width: number,\n}\nexport type GridSpace = \"gridspace\";\nexport type CanvasSpace = \"canvasspace\";\nexport type ClientSpace = \"clientspace\";\n\nconst minScale = 0.2;\nconst maxScale = 2;\n\nexport interface ViewportRef {\n  clientToGrid(coord: [number, number]): Coord<GridSpace>\n}\n\nexport interface Transform {\n  scale: number,\n  offset: Coord<GridSpace>,\n}\n\nexport const ViewportElem: ForwardRefRenderFunction<ViewportRef, PropsWithChildren<ViewportProps>> = (props, ref) => {\n  const viewport = useRef<HTMLDivElement>(null);\n  const canvas = useRef<HTMLDivElement>(null);\n\n  const transform = useRef<Transform>({\n    scale: 1,\n    offset: [0, 0] as Coord<GridSpace>,\n  });\n\n  const setTransform = (f: (t: Transform) => Transform) => {\n    const newT = f(transform.current);\n    const newOffset = [\n      clamp(newT.offset[0], 0, props.width),\n      clamp(newT.offset[1], 0, props.height)\n    ]\n    transform.current = {\n      scale: newT.scale,\n      offset: newOffset as any,\n    }\n    console.log(\"offset\", transform.current.offset);\n    canvas.current!.style.fontSize = `${transform.current.scale * props.baseScalar}${props.baseUnit}`\n    viewport.current!.scrollTo(transform.current.offset[0] * 96 * transform.current.scale, transform.current.offset[1] * transform.current.scale * 96)\n  }\n    // Does fancy math to zoom around a mouse location. Location given relative to viewport\n    const performZoom = \n      (origin: Coord<GridSpace>, oldScale: number, newScale: number) => {\n        const delta = clamp(newScale - oldScale, -0.05, 0.05);\n        newScale = clamp(oldScale + delta, minScale, maxScale);\n        // if we don't return early, we'll end up sliding around\n        if (newScale === oldScale) {\n          return;\n        }\n        setTransform(t => {\n          console.log(transform.current.scale);\n          return {\n            scale: newScale,\n            offset: [\n                t.offset[0] - (t.offset[0] - origin[0]) * delta / oldScale,\n                t.offset[1] - (t.offset[1] - origin[1]) * delta / oldScale,\n            ] as Coord<GridSpace>\n          }\n        });\n      }\n  \n    // const drag = useDrag((state) => {\n    //   if (state.buttons !== 1) {\n    //     return;\n    //   }\n    //   setTransform(t => {\n    //     console.log(state);\n    //     let o = clientToGrid(sub(state.initial as Offset<ViewSpace>, state.delta as Offset<ViewSpace>));\n    //     o = coord_clamp(\n    //       o,\n    //       [0, 0],\n    //       [\n    //         props.width, props.height\n    //       ]\n    //     );\n    //     return {\n    //       ...t,\n    //       offset: o\n    //     };\n    //   });\n    // });\n  \n    const initialScale = useRef(1);\n    const pinch = useGesture(\n      {\n        onPinchEnd: () => {\n          initialScale.current = transform.current.scale;\n        },\n        onPinch: \n          (state: FullGestureState<\"pinch\">) => {\n            state.event?.preventDefault();\n            state.event?.stopPropagation();\n            console.log(\"pinch continuing\");\n            //@ts-ignore\n            const deltaY = state.event?.deltaY\n            //@ts-ignore\n            const client_origin = state.origin || [state.event!.clientX, state.event!.clientY] \n            console.log(\"client\", client_origin);\n            const origin =\n              clientToGrid(client_origin);\n            let newScale: number;\n            if (deltaY) {\n              let delta = -1 * deltaY * 0.05 * transform.current.scale;\n              newScale = transform.current.scale + delta;\n            } else {\n              newScale = (state.da[0] / state.initial[0] - 1) + initialScale.current!;\n            }\n            performZoom(\n              origin,\n              transform.current.scale,\n              newScale\n            );\n          },\n        onPinchStart: useCallback(\n          (state: FullGestureState<\"pinch\">) => {\n            state.event?.preventDefault();\n            state.event?.stopPropagation();\n            console.log(\"pinchstarting\");\n            initialScale.current = transform.current.scale;\n            console.log(\"initialscale\", initialScale.current);\n          },\n          [transform]\n        ),\n      },\n      {\n        domTarget: viewport,\n        eventOptions: {\n          passive: false,\n          capture: true,\n        },\n      }\n    );\n  //@ts-ignore\n  useEffect(pinch, [pinch]);\n  \n  const clientToGrid = (coord: [number, number]): Coord<GridSpace> => {\n     console.log(\"canvas\", canvas.current)\n      const rect = canvas.current!.getBoundingClientRect();\n    console.log(\"rect\", rect);\n    console.log(\"coord\", coord);\n      return [\n        (coord[0] - rect.left) / 96 / transform.current.scale,\n        (coord[1] - rect.top) / 96 / transform.current.scale,\n      ] as Coord<GridSpace>;\n    }\n  \n  useImperativeHandle(ref, () => ({\n    clientToGrid,\n  }), []);\n\n    // Wheel must come first to prevent its use by pinch,\n    // because the logic for how to zoom on each is different\n    const scroll = useGesture({\n      onScrollEnd(state: FullGestureState<'scroll'>) {\n        console.log(\"OOPS\", state.pinching);\n        setTransform(t => ({\n          ...t,\n          offset: [viewport.current!.scrollLeft / 96 / transform.current.scale, viewport.current!.scrollTop / 96 / transform.current.scale] as any,\n        }));\n      },\n    });\n    // useLayoutEffect(() => {\n    //   viewport.current?.scrollTo(...(transform.current.offset as [number, number]));\n    // }, []);\n    return (\n      <div className=\"viewport\" {...scroll()} ref={viewport}>\n        <div\n          className=\"gridsvg\"\n          ref={canvas}\n                style={{\n                  width: `${props.width}em`,\n                  height: `${props.height}em`,\n                  fontSize: `${transform.current.scale * props.baseScalar}${props.baseUnit}`,\n                  position: \"relative\",\n                }}>\n                {props.children}\n            </div>\n        </div>\n    )\n}\n\nexport const Viewport = memo(forwardRef(ViewportElem));","import { GridSpace } from \"./Viewport\";\nimport { Coord, Offset } from \"./util\";\nimport { PropsWithChildren, memo } from \"react\";\nimport React from \"react\";\n\nexport interface GridItemProps extends React.DetailedHTMLProps<React.HTMLAttributes<HTMLDivElement>, HTMLDivElement> {\n  loc: Coord<GridSpace>,\n  dim: Offset<GridSpace>,\n  style?: Omit<React.CSSProperties, 'position' | 'left' | 'top' | 'width' | 'height'>,\n}\n\nexport const GridItem = memo((props: PropsWithChildren<GridItemProps>) => {\n  return (\n    <div\n      {...props}\n      style={{\n        position: \"absolute\",\n        left: props.loc[0] + \"em\",\n        top: props.loc[1] + \"em\",\n        width: 0.05 + props.dim[0] + \"em\",\n        height: 0.05 + props.dim[1] + \"em\",\n        ...props.style,\n      }}\n      >\n      {props.children}\n    </div>\n  )\n});","import { ClientSpace } from \"./Viewport\";\nimport { Coord, coord } from \"./util\";\nimport { useRef, useCallback } from \"react\";\nimport { GridItemProps, GridItem } from \"./GridItem\";\nimport React, {PointerEvent} from \"react\";\n\ninterface SelectionProps extends GridItemProps {\n  onSelectionDrag: (offset: Coord<ClientSpace>) => void,\n  onSelectionDrop: (offset: Coord<ClientSpace>) => void,\n}\n\nfunction SelectionBox(props: SelectionProps) {\n  const initialLoc = useRef<Coord<ClientSpace> | null>(null)\n  // Represents the distance in client pixels from selection element origin to click point\n  const onPointerMove = useCallback((ev: PointerEvent<HTMLElement>) => {\n      if (initialLoc.current) {\n          ev.preventDefault();\n          ev.stopPropagation();\n          console.log(ev.clientX, ev.clientY)\n          props.onSelectionDrag(coord(ev));\n      }\n  }, [props])\n  const onPointerUp = useCallback((ev) => {\n      if (initialLoc.current !== null) {\n          ev.preventDefault();\n        ev.stopPropagation();\n        console.log(\"Drop!\");\n          //(ev.currentTarget as HTMLDivElement).releasePointerCapture(ev.pointerId);\n          props.onSelectionDrop(coord(ev));\n        initialLoc.current = null;\n      }\n  }, [props])\n  return (\n    <GridItem\n      loc={props.loc} \n      dim={props.dim}\n      style={{\n        border: \"0.05em solid ActiveBorder\",\n        boxShadow: \"0 0 5px activeborder\"\n      }}\n      onPointerDown={ev => {\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                    console.log(\"CLICKED SELECTION ?D?D!\")\n        ev.currentTarget.setPointerCapture(ev.pointerId);\n        initialLoc.current = coord(ev);\n      }}\n      onPointerMoveCapture={onPointerMove}\n      onPointerUpCapture={onPointerUp}\n    ></GridItem>\n  )\n}\n\nexport default SelectionBox;","import { PropsWithChildren, useRef, useState, memo } from \"react\";\nimport { Coord, add, floor, sub } from \"./util\";\nimport React from \"react\";\nimport Overlay from \"./Overlay2\";\nimport \"./grid.css\";\nimport { Viewport, GridSpace, ViewportRef } from \"./Viewport\";\nimport useDrop from \"../util/useDrop\";\nimport { GridItem } from \"./GridItem\";\nimport SelectionBox from \"./SelectionBox\";\n\nexport interface GridProps {\n  dimensions: [number, number];\n}\n\nexport function Grid(props: PropsWithChildren<GridProps>) {\n  let dropLayer = useRef<HTMLDivElement>(null);\n  let selection = useRef<any>(null);\n  let [selectionOffset, setSelectionOffset] = useState<any>(null);\n  let viewport = useRef<ViewportRef>(null);\n  let hoverHint = useRef<HTMLDivElement>(null);\n  let [items, setItems] = useState<any[]>([]);\n\n  let [dragging, drag, dragHandlers] = useDrop(\n    dropLayer,\n    (x, y) => {\n      if (hoverHint.current) {\n        let coords = viewport.current!.clientToGrid([x, y]);\n        hoverHint.current.style.left = Math.floor(coords[0] as number) + \"em\";\n        hoverHint.current.style.top = Math.floor(coords[1] as number) + \"em\";\n      }\n    },\n    (ev) => {\n      let coords = viewport.current!.clientToGrid([ev.clientX, ev.clientY]);\n      console.log(\"DROP!\");\n      let dataItems = ev.dataTransfer?.items ?? [];\n      let addItem = (s: string, i: number) => {\n        console.log(\"adding item?\");\n        let item = {\n          id: \"\" + Math.random(),\n          x: Math.floor(coords[0]) + i,\n          y: Math.floor(coords[1]),\n          width: 1,\n          height: 1,\n          href: s,\n        };\n        console.log(\"DROPPING? \", item);\n        setItems([...items, item]);\n      };\n      console.log(\"event\", ev);\n      console.log(\"items\", dataItems);\n      for (let i = 0; i < dataItems.length; i++) {\n        console.log(dataItems[i]);\n        if (dataItems[i].kind.startsWith(\"image/\")) {\n          addItem(window.URL.createObjectURL(dataItems[i].getAsFile()), 0);\n        } else if (dataItems[i].type === \"text/uri-list\") {\n          dataItems[i].getAsString((s) => addItem(s, 0));\n        }\n      }\n    }\n  );\n  let gridDrag: Coord<GridSpace>;\n  if (dragging) {\n    gridDrag = viewport.current!.clientToGrid([drag.x, drag.y]);\n  }\n  console.log(items);\n  return (\n    <div className=\"grid\" {...dragHandlers} ref={dropLayer}>\n      <Viewport\n        ref={viewport}\n        baseScalar={1}\n        baseUnit=\"in\"\n        width={props.dimensions[0]}\n        height={props.dimensions[1]}\n      >\n        {dragging ? (\n          <div\n            ref={hoverHint}\n            key=\"hover\"\n            style={{\n              position: \"absolute\",\n              left: Math.floor(gridDrag![0]) + \"em\",\n              top: Math.floor(gridDrag![1]) + \"em\",\n              width: \"1em\",\n              height: \"1em\",\n              background: \"#aaa\",\n            }}\n          ></div>\n        ) : null}\n        {items.map((i) => (\n          <GridItem\n            key={i.id}\n            loc={\n              add(\n                [i.x, i.y] as any,\n                selection.current?.id === i.id\n                  ? (selectionOffset as any)\n                  : [0, 0]\n              ) as any\n            }\n            dim={[1, 1] as any}\n            onClick={() => {\n              selection.current = i;\n              setSelectionOffset([0, 0]);\n            }}\n          >\n            <img\n              alt=\"\"\n              src={i.href}\n              style={{ display: \"block\", width: \"100%\", height: \"100%\" }}\n            />\n          </GridItem>\n        ))}\n        <Overlay width={props.dimensions[0]} height={props.dimensions[1]} />\n        <div style={{\n          position: \"absolute\",\n          left: 0,\n          top: 0,\n          height: \"790px\",\n          width: \"1191px\",\n          border: \"1px solid blue\"\n        }}></div>\n        {selection.current && (\n          <SelectionBox\n            key=\"\"\n            loc={\n              add(selectionOffset!, [\n                selection.current.x,\n                selection.current.y,\n              ] as any) as any\n            }\n            dim={[1, 1] as any}\n            onSelectionDrag={(coord) =>\n              setSelectionOffset(\n                floor(\n                  sub(viewport.current!.clientToGrid(coord), [\n                    selection.current.x,\n                    selection.current.y,\n                  ] as any)\n                )\n              )\n            }\n            onSelectionDrop={(coord) => {\n              const loc = floor(viewport.current!.clientToGrid(coord));\n              const currId = selection.current.id;\n              setItems((items) =>\n                items.map((it) => {\n                  if (it.id === currId) {\n                    return { ...it, x: loc[0], y: loc[1] };\n                  } else {\n                    return it;\n                  }\n                })\n              );\n              setSelectionOffset(null);\n              selection.current = null;\n            }}\n          />\n        )}\n      </Viewport>\n    </div>\n  );\n}\n\nexport default memo(Grid);\n","import { useState } from \"react\";\nexport interface DragState {\n  x: number,\n  y: number,\n}\n\nexport default function useDrop(\n  ref: React.RefObject<Element | null>,\n  onDrag: (x: number, y: number) => void,\n  onDrop: (ev: DragEvent) => void\n): [boolean, DragState, any] {\n  let [dragDepth, setDragDepth] = useState(0);\n  let [dragState, setDragState] = useState({\n    x: 0,\n    y: 0,\n  });\n  console.log(dragDepth)\n  const dropStub = (ev: DragEvent) => {\n    ev.preventDefault();\n    console.log(\"DROPPED!\")\n    let [x, y] = [ev.clientX, ev.clientY];\n    setDragDepth(0);\n    setDragState({\n      x,\n      y,\n    });\n    onDrop(ev);\n  };\n  const onDragEnter = (ev: DragEvent) => {\n    ev.preventDefault();\n    ev.stopPropagation();\n    let [x, y] = [ev.clientX, ev.clientY];\n    setDragDepth(d => d + 1);\n    setDragState({\n      x,\n      y,\n    });\n  };\n  const onDragLeave = (ev: DragEvent) => {\n    ev.preventDefault();\n    ev.stopPropagation();\n    let [x, y] = [ev.clientX, ev.clientY];\n    setDragDepth(d => d - 1);\n    setDragState({\n      x,\n      y,\n    });\n    };\n  const onDragOver = (ev: DragEvent) => {\n    ev.preventDefault();\n    onDrag(ev.clientX, ev.clientY)\n  };\n    return [dragDepth > 0, dragState, {\n        onDragEnter,\n        onDragLeave,\n        onDragOver,\n        onDrop: dropStub,\n    }]\n}\n","import { PropsWithChildren } from \"react\";\nimport React from \"react\";\nimport \"./Toolbar.css\";\n\ninterface ToolbarProps {}\nfunction Toolbar(props: PropsWithChildren<ToolbarProps>) {\n    return (\n        <div className=\"toolbar\">\n            {props.children}\n        </div>);\n}\nexport default Toolbar","import Peer from \"peerjs\";\n\n\nexport type ClientConfig = {\n  onMessage(msg: any): void\n}\n\nexport class Client {\n  private server: Peer.DataConnection;\n\n  private constructor(server: Peer.DataConnection, config: ClientConfig) {\n    this.server = server;\n    this.server.on('data', d => {\n      config.onMessage(d)\n    })\n    this.server.on('error', d => {\n      console.log(\"ERROR!\")\n    })\n  }\n\n  static async connect(serverId: string, config: ClientConfig): Promise<Client> {\n    const peer = new Peer(undefined, {debug: 3});\n    let connected = false;\n    return new Promise((resolve, reject) => {\n      peer.on('open', id => {\n        const server = peer.connect(serverId, {reliable: true,});\n        let client = new Client(server, config);\n        server.on(\"open\", () => {\n          console.log(\"Open sesame?\")\n          connected = true;\n          resolve(client)\n        });\n        server.on(\"error\", (e) => {\n          !connected && reject(`Error connecting to game host: ${e}`)\n        });\n      });\n      peer.on(\"error\", (e) => {\n        !connected && reject(`Error connecting to signaling server: ${e}`)\n      })\n    });\n  }\n} ","import Peer from \"peerjs\";\nimport { ConnId } from \".\";\n\ntype Config = {\n  onConnect?(label: ConnId): void\n  onDisconnect?(label: ConnId): void\n}\n\nexport class Server {\n  private peer: Peer;\n  private clients: Map<string, Peer.DataConnection>;\n  readonly id: string;\n\n  private constructor(id: string, peer: Peer, config: Config) {\n    this.peer = peer;\n    this.id = id;\n    this.clients = new Map();\n\n    this.peer.on('connection', conn => {\n      conn.on('open', () => {\n        const label = conn.label as ConnId;\n        this.clients.set(label, conn);\n        config.onConnect && config.onConnect(label);\n        config.onDisconnect && conn.on('close', () => {\n          console.log(\"Disconnecting?\")\n          config.onDisconnect!(label)\n        })\n      })\n    })\n\n    this.peer.on('disconnected', () => {\n      console.error(\"ACK! Disconnect from signaler.\")\n    })\n  }\n\n  static async create(config: Config): Promise<Server> {\n    const peer = new Peer(undefined, {debug: 3});\n    let connected = false;\n    return new Promise((resolve, reject) => {\n      peer.on(\"open\", id => {\n        connected = true;\n        resolve(new Server(id, peer, config))\n      });\n\n      peer.on(\"error\", (e) => {\n        connected && reject(`Failed to create server: ${e}`)\n      })\n    })\n  }\n\n  broadcast_json(msg: any) {\n    for (let c of this.clients.values()) {\n      console.log(\"sending!\");\n      c.send(msg);\n    }\n  }\n\n  send(label: ConnId, msg: any) {\n    this.clients.get(label)!.send(msg);\n  }\n}","import { createSlice } from \"@reduxjs/toolkit\";\nimport { createAsyncThunk } from \"@reduxjs/toolkit\";\n\nconst sleep = (m: number) => new Promise(r => setTimeout(r, m))\nexport const issueToast = createAsyncThunk('toast/issue', async (msg: string, { dispatch }) => {\n  const id = Date.now();\n  dispatch(addToast({ id: Date.now(), msg }));\n  await sleep(5000);\n  dispatch(removeToast(id));\n});\n\nexport const toast = createSlice({\n  name: 'toast',\n  initialState: {\n    toasts: [] as { id: number, msg: string }[]\n  },\n  reducers: {\n    addToast(state, { payload }: { payload: { id: number, msg: string } }) {\n      state.toasts.push(payload);\n    },\n    removeToast(state, { payload }: { payload: number }) {\n      state.toasts = state.toasts.filter(t => t.id !== payload)\n    }\n  }\n})\n\nexport default toast.reducer;\nexport const { addToast, removeToast } = toast.actions;","import {createSlice, createAsyncThunk} from \"@reduxjs/toolkit\"\nimport { Client } from \"./client\";\nimport { Server } from \"./server\";\nimport { issueToast } from \"../toast\";\n\nexport const state = {\n  client: null as Client | null,\n  host: null as Server | null,\n\n}\n\nexport type ConnId = string & {\n  _connId: 'connid' \n} \n\nexport const connect = createAsyncThunk('posts/fetchPosts', async (gameId: string, { dispatch }) => {\n  try {\n    state.client = await Client.connect(gameId, {\n      onMessage(m: any) {\n        dispatch(m);\n      }\n    });\n    return gameId;\n  }\n  catch(e) {\n    dispatch(issueToast(\"joinFailure\"));\n    throw e;\n  }\n});\n\nexport const start_hosting = createAsyncThunk('posts/fetchPosts', async (_: undefined, {dispatch}) => {\n  state.host = await Server.create({\n    onConnect(label) {\n      dispatch(slice.actions.addPlayer(label))\n    }\n  })\n  window.history.pushState({}, \"\", `?join=${state.host.id}`)\n  return state.host.id;\n});\n\nexport const slice = createSlice({\n  name: 'conn',\n  initialState: {\n    connected: false,\n    hosting: false,\n    gameId: null as string | null,\n    players: [] as ConnId[],\n  },\n  reducers: {\n    addPlayer(state, { payload }) {\n      state.players.push(payload)\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(connect.fulfilled, (state, { payload }) => {\n      state.gameId = payload\n      state.connected = true\n    })\n  }\n})\n\nexport default slice.reducer;","import { createSlice } from \"@reduxjs/toolkit\";\n\nexport const slice = createSlice({\n  name: 'grid',\n  initialState: {\n    width: 30,\n    height: 30,\n  },\n  reducers: {\n    setDimensions(state, { payload }: {payload: {width: number, height: number}}) {\n      state.width = payload.width;\n      state.height = payload.height;\n    }\n  }\n})\n\nexport default slice.reducer;\nexport const { setDimensions } = slice.actions;","import { useSelector } from \"react-redux\"\nimport { RootStore } from \"../../store\";\nimport React from \"react\";\nimport \"./Toast.css\";\nimport { useTranslation } from \"react-i18next\";\nimport { motion, AnimateSharedLayout } from \"framer-motion\";\n\nexport function ToastArea(props: {}) {\n  const toasts = useSelector((state: RootStore) => state.toast.toasts);\n  const { t } = useTranslation();\n  return (<div className=\"toastArea\">\n    <AnimateSharedLayout>\n    {\n      toasts.map(toast =>\n        <motion.div className=\"toast\"\n          initial={{position: \"relative\", opacity: 0}} \n          animate={{position: \"relative\", opacity: 1}} \n          exit={{ position: \"relative\", opacity: 0 }} \n          layout\n          key={toast.id}\n        >\n          {t(toast.msg)}\n        </motion.div>\n      )\n      }\n    </AnimateSharedLayout>\n    </div>\n  )\n}","import React from \"react\";\nimport \"./App.css\";\nimport Grid from \"./grid2/Grid\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport Toolbar from \"./toolbar/Toolbar\";\nimport { Offset } from \"./grid2/util\";\nimport { GridSpace } from \"./grid2/Viewport\";\nimport { RootStore } from \"../store\";\nimport { start_hosting } from \"../modules/comms\";\nimport { setDimensions } from \"../modules/grid\";\nimport { ToastArea } from \"./toasts/ToastArea\";\nimport { issueToast } from \"../modules/toast\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface Rect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nfunction App() {\n  let comms = useSelector((state: RootStore) => {\n    console.log(state);\n    return state.comms\n  });\n  let dim = useSelector((state: RootStore) => [state.grid.width, state.grid.height])\n  let dispatch = useDispatch();\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"App\">\n      <ToastArea />\n      <Grid dimensions={dim as Offset<GridSpace>} />\n      <Toolbar>\n        <button onClick={() => dispatch(setDimensions({width: dim[0] + 1, height: dim[1]}))}>Add Column</button>\n        <button onClick={() => dispatch(setDimensions({width: dim[0], height: dim[1] + 1}))}>Add Row</button>\n        <button onClick={() => dispatch(issueToast(t(\"hello\")))}>Say hi</button>\n        {!comms.connected && (\n          <button onClick={() => dispatch(start_hosting())}>Host</button>\n        )}\n\n        {comms.hosting && `hosting: ${comms.gameId}`}\n        {comms.connected &&\n          !comms.hosting &&\n          comms.players.map((p) => <span key={p}>{p}</span>)}\n      </Toolbar>\n    </div>\n  );\n}\n\nexport default App;\n","import { configureStore } from '@reduxjs/toolkit'\nimport comms, {state} from './modules/comms'\nimport grid from './modules/grid'\nimport toast from './modules/toast'\n\nconst store = configureStore({\n  reducer: {\n    comms, grid, toast\n  },\n  middleware: m => [...m(), api => next => action => {\n    console.log(action);\n    state.host && state.host.broadcast_json(action);\n    return next(action);\n  }]\n})\n\nexport default store;\nexport type RootStore = ReturnType<typeof store.getState>","import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\n \nimport Backend from 'i18next-xhr-backend';\n \ni18n\n  .use(Backend)\n  .use(initReactI18next)\n  // for all options read: https://www.i18next.com/overview/configuration-options\n  .init({\n    debug: true,\n \n    lng: 'en',\n    fallbackLng: 'en',\n    whitelist: ['en', 'de'],\n \n    interpolation: {\n      escapeValue: false, // not needed for react as it escapes by default\n    },\n    backend: {\n      loadPath: '/battlegrid/locales/{{lng}}/{{ns}}.json',\n    },\n  });\n \nexport default i18n;","import React, {Suspense} from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './components/App';\nimport { Provider } from 'react-redux';\nimport store from './store'\nimport { connect } from './modules/comms';\nimport './i18n';\n//import * as serviceWorker from './serviceWorker';\n\nconst urlParams = new URLSearchParams(window.location.search);\nconst game = urlParams.get(\"join\");\nif (game) {\n  store.dispatch(connect(game));\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <Suspense fallback={null}>\n      <Provider store={store}>\n        <App />\n      </Provider>\n    </Suspense>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n//serviceWorker.unregister();\n"],"sourceRoot":""}