(this.webpackJsonpbattlegrid=this.webpackJsonpbattlegrid||[]).push([[0],{35:function(e,t,n){e.exports=n(58)},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},49:function(e,t,n){},51:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=51},52:function(e,t,n){},58:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(15),o=n.n(a),i=(n(40),n(41),n(6)),u=n(20),s=n(9);function l(e){return[e.clientX,e.clientY]}function d(e){return e.map(Math.floor)}function f(e,t){return[e[0]+t[0],e[1]+t[1]]}function v(e,t,n){return Math.min(n,Math.max(t,e))}var p=c.a.memo((function(e){return c.a.createElement("div",{style:{position:"absolute",left:"".concat(-.025,"em"),right:"".concat(-.025,"em"),top:"".concat(-.025,"em"),bottom:"".concat(-.025,"em"),background:"\n      repeating-linear-gradient(to right, ".concat("gray",", ").concat("gray"," ").concat(.05,"em, transparent ").concat(.05,"em 1em),\n      repeating-linear-gradient(to bottom, ").concat("gray",", ").concat("gray"," ").concat(.05,"em, transparent ").concat(.05,"em 1em)"),pointerEvents:"none",border:"".concat(.025," solid ").concat("gray")}})})),m=(n(42),n(22)),h=Object(r.memo)(Object(r.forwardRef)((function(e,t){var n=Object(r.useRef)(null),a=Object(r.useRef)(null),o=Object(r.useRef)({scale:1,offset:[0,0]}),u=function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=t(o.current),a=[v(c.offset[0],0,e.width),v(c.offset[1],0,e.height)];o.current={scale:c.scale,offset:a},r&&(n.current.style.fontSize="".concat(o.current.scale*e.baseScalar).concat(e.baseUnit),n.current.scrollTo(96*o.current.offset[0]*o.current.scale,o.current.offset[1]*o.current.scale*96))},s=Object(r.useRef)(1),l=Object(m.a)({onPinchEnd:function(){s.current=o.current.scale},onPinch:function(e){var t,n,r;null===(t=e.event)||void 0===t||t.preventDefault(),null===(n=e.event)||void 0===n||n.stopPropagation();var c,a=null===(r=e.event)||void 0===r?void 0:r.deltaY,i=e.origin||[e.event.clientX,e.event.clientY],l=d(i);if(a){var f=-1*a*.05*o.current.scale;c=o.current.scale+f}else c=e.da[0]/e.initial[0]-1+s.current;!function(e,t,n){var r=v(n-t,-.05,.05);(n=v(t+r,.2,2))!==t&&u((function(c){return{scale:n,offset:[c.offset[0]-(c.offset[0]-e[0])*r/t,c.offset[1]-(c.offset[1]-e[1])*r/t]}}))}(l,o.current.scale,c)},onPinchStart:Object(r.useCallback)((function(e){var t,n;null===(t=e.event)||void 0===t||t.preventDefault(),null===(n=e.event)||void 0===n||n.stopPropagation(),s.current=o.current.scale}),[o])},{domTarget:n,eventOptions:{passive:!1,capture:!0}});Object(r.useEffect)(l,[l]);var d=function(e){var t=a.current.getBoundingClientRect();return[(e[0]-t.left)/96/o.current.scale,(e[1]-t.top)/96/o.current.scale]};Object(r.useImperativeHandle)(t,(function(){return{clientToGrid:d}}),[]);var f=Object(m.a)({onScrollEnd:function(e){u((function(e){return Object(i.a)(Object(i.a)({},e),{},{offset:[n.current.scrollLeft/96/o.current.scale,n.current.scrollTop/96/o.current.scale]})}),!1)}});return c.a.createElement("div",Object.assign({className:"viewport"},f(),{ref:n,style:{fontSize:"".concat(o.current.scale*e.baseScalar).concat(e.baseUnit)}}),c.a.createElement("div",{className:"padding"},c.a.createElement("div",{className:"gridsvg",ref:a,style:{width:"".concat(e.width,"em"),height:"".concat(e.height,"em"),position:"relative"}},e.children)))})));var b=Object(r.memo)((function(e){return c.a.createElement("div",Object.assign({},e,{style:Object(i.a)({position:"absolute",left:e.loc[0]+"em",top:e.loc[1]+"em",width:e.dim[0]+"em",height:e.dim[1]+"em"},e.style)}),e.children)}));var g=function(e){var t=Object(r.useRef)(null),n=Object(r.useCallback)((function(n){t.current&&(n.preventDefault(),n.stopPropagation(),e.onSelectionDrag(l(n)))}),[e]),a=Object(r.useCallback)((function(n){null!==t.current&&(n.preventDefault(),n.stopPropagation(),e.onSelectionDrop(l(n)),t.current=null)}),[e]);return c.a.createElement(b,{loc:e.loc,dim:e.dim,style:{border:"2px solid buttonFace",boxShadow:"0 0 10px buttonFace"},onPointerDown:function(e){e.preventDefault(),e.stopPropagation(),e.currentTarget.setPointerCapture(e.pointerId),t.current=l(e)},onPointerMoveCapture:n,onPointerUpCapture:a})};var j=Object(r.memo)((function(e){var t,n=Object(r.useRef)(null),a=Object(r.useRef)(null),o=Object(r.useState)(null),l=Object(s.a)(o,2),v=l[0],m=l[1],j=Object(r.useRef)(null),O=Object(r.useRef)(null),y=Object(r.useState)([]),w=Object(s.a)(y,2),E=w[0],k=w[1],S=function(e,t,n){var c=Object(r.useState)(0),a=Object(s.a)(c,2),o=a[0],i=a[1],u=Object(r.useState)({x:0,y:0}),l=Object(s.a)(u,2),d=l[0],f=l[1];return[o>0,d,{onDragEnter:function(e){e.preventDefault(),e.stopPropagation();var t=[e.clientX,e.clientY],n=t[0],r=t[1];i((function(e){return e+1})),f({x:n,y:r})},onDragLeave:function(e){e.preventDefault(),e.stopPropagation();var t=[e.clientX,e.clientY],n=t[0],r=t[1];i((function(e){return e-1})),f({x:n,y:r})},onDragOver:function(e){e.preventDefault(),t(e.clientX,e.clientY)},onDrop:function(e){e.preventDefault();var t=[e.clientX,e.clientY],r=t[0],c=t[1];i(0),f({x:r,y:c}),n(e)}}]}(0,(function(e,t){if(O.current){var n=j.current.clientToGrid([e,t]);O.current.style.left=Math.floor(n[0])+"em",O.current.style.top=Math.floor(n[1])+"em"}}),(function(e){for(var t,n,r=j.current.clientToGrid([e.clientX,e.clientY]),c=null!==(t=null===(n=e.dataTransfer)||void 0===n?void 0:n.items)&&void 0!==t?t:[],a=function(e,t){var n={id:""+Math.random(),x:Math.floor(r[0])+t,y:Math.floor(r[1]),width:1,height:1,href:e};k([].concat(Object(u.a)(E),[n]))},o=0;o<c.length;o++)c[o].kind.startsWith("image/")?a(window.URL.createObjectURL(c[o].getAsFile()),0):"text/uri-list"===c[o].type&&c[o].getAsString((function(e){return a(e,0)}))})),C=Object(s.a)(S,3),x=C[0],D=C[1],T=C[2];return x&&(t=j.current.clientToGrid([D.x,D.y])),c.a.createElement("div",Object.assign({className:"grid"},T,{ref:n}),c.a.createElement(h,{ref:j,baseScalar:1,baseUnit:"in",width:e.dimensions[0],height:e.dimensions[1]},x?c.a.createElement("div",{ref:O,key:"hover",style:{position:"absolute",left:Math.floor(t[0])+"em",top:Math.floor(t[1])+"em",width:"1em",height:"1em",background:"#aaa"}}):null,E.map((function(e){var t;return c.a.createElement(b,{key:e.id,loc:f([e.x,e.y],(null===(t=a.current)||void 0===t?void 0:t.id)===e.id?v:[0,0]),dim:[1,1],onClick:function(){a.current=e,m([0,0])}},c.a.createElement("img",{alt:"",src:e.href,style:{display:"block",width:"100%",height:"100%"}}))})),c.a.createElement(p,{width:e.dimensions[0],height:e.dimensions[1]}),a.current&&c.a.createElement(g,{key:"",loc:f(v,[a.current.x,a.current.y]),dim:[1,1],onSelectionDrag:function(e){return m(d((t=j.current.clientToGrid(e),n=[a.current.x,a.current.y],[t[0]-n[0],t[1]-n[1]])));var t,n},onSelectionDrop:function(e){var t=d(j.current.clientToGrid(e)),n=a.current.id;k((function(e){return e.map((function(e){return e.id===n?Object(i.a)(Object(i.a)({},e),{},{x:t[0],y:t[1]}):e}))})),m(null),a.current=null}})))})),O=n(10);n(49);var y=function(e){return c.a.createElement("div",{className:"toolbar"},e.children)},w=n(1),E=n.n(w),k=n(8),S=n(2),C=n(16),x=n(13),D=n(17),T=n.n(D),M=function(){function e(t,n,r){Object(C.a)(this,e),this.server=void 0,this.peer=void 0,this.server=n,this.peer=t,this.server.on("data",(function(e){r.onMessage(e)})),this.server.on("error",(function(e){console.error(e)}))}return Object(x.a)(e,[{key:"id",get:function(){return this.peer.id}}]),Object(x.a)(e,[{key:"send",value:function(e){this.server.send(e)}}],[{key:"connect",value:function(){var t=Object(k.a)(E.a.mark((function t(n,r){var c,a;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=new T.a(void 0,{debug:3}),a=!1,t.abrupt("return",new Promise((function(t,o){c.on("open",(function(i){var u=c.connect(n,{reliable:!0});u.on("open",(function(){a=!0;var n=new e(c,u,r);setTimeout((function(){return r.onConnect(n)}),0),t(n)})),u.on("error",(function(e){!a&&o("Error connecting to game host: ".concat(e))}))})),c.on("error",(function(e){!a&&o("Error connecting to signaling server: ".concat(e))}))})));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}(),P=n(30),R=function(){function e(t,n,r){var c=this;Object(C.a)(this,e),this.peer=void 0,this.clients=void 0,this.id=void 0,this.peer=n,this.id=t,this.clients=new Map,this.peer.on("connection",(function(e){e.on("open",(function(){var t=e.label;c.clients.set(t,e),r.onConnect&&r.onConnect(t),r.onDisconnect&&e.on("close",(function(){r.onDisconnect(t)})),e.on("data",(function(t){c.broadcast_json(t,e.label),r.onMessage&&r.onMessage(t)}))}))})),this.peer.on("disconnected",(function(){console.error("ACK! Disconnect from signaler.")}))}return Object(x.a)(e,[{key:"broadcast_json",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=Object(P.a)(this.clients);try{for(r.s();!(t=r.n()).done;){var c=Object(s.a)(t.value,2),a=c[0],o=c[1];a!==n&&o.send(e)}}catch(i){r.e(i)}finally{r.f()}}},{key:"send",value:function(e){this.broadcast_json(e)}},{key:"sendTo",value:function(e,t){this.clients.get(e).send(t)}}],[{key:"create",value:function(){var t=Object(k.a)(E.a.mark((function t(n){var r,c;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new T.a(void 0,{debug:3}),c=!1,t.abrupt("return",new Promise((function(t,a){r.on("open",(function(a){c=!0,t(new e(a,r,n))})),r.on("error",(function(e){c&&a("Failed to create server: ".concat(e))}))})));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}(),N=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Y=Object(S.b)("toast/issue",function(){var e=Object(k.a)(E.a.mark((function e(t,n){var r,c;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.dispatch,c=Date.now(),r(L({id:Date.now(),msg:t})),e.next=5,N(5e3);case 5:r(X(c));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),A=Object(S.c)({name:"toast",initialState:{toasts:[]},reducers:{addToast:function(e,t){var n=t.payload;e.toasts.push(n)},removeToast:function(e,t){var n=t.payload;e.toasts=e.toasts.filter((function(e){return e.id!==n}))}}}),U=A.reducer,I=A.actions,L=I.addToast,X=I.removeToast,_={conn:null},F=Object(S.b)("comms/connect",function(){var e=Object(k.a)(E.a.mark((function e(t,n){var r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.dispatch,e.prev=1,e.next=4,M.connect(t,{onMessage:function(e){r(e)},onConnect:function(e){console.log("connected to server!")}});case 4:return _.conn=e.sent,e.abrupt("return",t);case 8:throw e.prev=8,e.t0=e.catch(1),r(Y("joinFailure")),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}()),G=Object(S.b)("comms/host",function(){var e=Object(k.a)(E.a.mark((function e(t,n){var r,c,a;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,c=n.dispatch,e.next=3,R.create({onConnect:function(e){a.sendTo(e,{type:"STATE_SYNC",payload:{grid:r().grid}})},onMessage:function(e){c(e)}});case 3:return a=e.sent,_.conn=a,window.history.pushState({},"","?join=".concat(a.id)),e.abrupt("return",a.id);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());var z,B=Object(S.c)({name:"comms",initialState:{status:"offline",hosting:!1,gameId:null},reducers:{},extraReducers:function(e){e.addCase(F.pending,(function(e,t){e.status="pending"})),e.addCase(F.fulfilled,(function(e,t){var n=t.payload;e.gameId=n,e.status="connected"})),e.addCase(F.rejected,(function(e,t){e.status="offline"})),e.addCase(G.pending,(function(e,t){e.status="pending"})),e.addCase(G.fulfilled,(function(e,t){var n=t.payload;e.status="connected",e.gameId=n,e.hosting=!0})),e.addCase(G.rejected,(function(e,t){e.status="offline"}))}}).reducer,H=Object(S.c)({name:"grid",initialState:{width:15,height:10},reducers:{setDimensions:(z=function(e,t){var n=t.payload;e.width=n.width,e.height=n.height},{reducer:z,prepare:function(e){return{payload:e,meta:_.conn?{shared:!0,src:_.conn.id}:{}}}})}}),J=H.reducer,K=H.actions.setDimensions,V=(n(52),n(60)),W=n(26);function q(e){var t=Object(O.c)((function(e){return e.toast.toasts})),n=Object(V.a)().t;return c.a.createElement("div",{className:"toastArea"},c.a.createElement(W.a,null,t.map((function(e){return c.a.createElement(W.b.div,{className:"toast",initial:{position:"relative",opacity:0},animate:{position:"relative",opacity:1},exit:{position:"relative",opacity:0},layout:!0,key:e.id},n(e.msg))}))))}var Q=function(){var e=Object(O.c)((function(e){return console.log(e),e.comms})),t=Object(O.c)((function(e){return[e.grid.width,e.grid.height]})),n=Object(O.b)(),r=Object(V.a)().t;return c.a.createElement("div",{className:"App"},c.a.createElement(q,null),c.a.createElement(j,{dimensions:t}),c.a.createElement(y,null,c.a.createElement("button",{onClick:function(){return n(K({width:t[0]+1,height:t[1]}))}},"Add Column"),c.a.createElement("button",{onClick:function(){return n(K({width:t[0],height:t[1]+1}))}},"Add Row"),c.a.createElement("button",{onClick:function(){return n(Y(r("hello")))}},"Say hi"),"offline"===e.status&&c.a.createElement("button",{onClick:function(){return n(G())}},"Host"),e.hosting&&"hosting: ".concat(e.gameId)))},Z=n(5);console.log(B);var $=Object(Z.c)({comms:B,grid:J,toast:U}),ee=Object(S.a)({reducer:function(e,t){return"STATE_SYNC"===t.type?Object(i.a)(Object(i.a)({},e),{},{grid:t.payload.grid}):$(e,t)},middleware:function(e){return[].concat(Object(u.a)(e()),[function(e){return function(e){return function(t){var n,r,c;return _.conn&&(null===(n=t.meta)||void 0===n?void 0:n.shared)&&(null===(r=t.meta)||void 0===r?void 0:r.src)===(null===(c=_.conn)||void 0===c?void 0:c.id)&&_.conn.send(t),e(t)}}}])},preloadedState:$(void 0,{type:"null"})}),te=n(25),ne=n(14),re=n(34);te.a.use(re.a).use(ne.e).init({debug:!0,lng:"en",fallbackLng:"en",whitelist:["en","de"],interpolation:{escapeValue:!1},backend:{loadPath:"/battlegrid/locales/{{lng}}/{{ns}}.json"}});te.a;var ce=new URLSearchParams(window.location.search).get("join");ce&&ee.dispatch(F(ce)),o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(r.Suspense,{fallback:null},c.a.createElement(O.a,{store:ee},c.a.createElement(Q,null)))),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.61d23d16.chunk.js.map